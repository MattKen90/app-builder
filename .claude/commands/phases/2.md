---
description: Phase 2 - Technical Foundation. Design architecture and build roadmap from the vision.
---

# Phase 2: Technical Foundation

**Mission**: Transform VISION.md into a buildable architecture and sequenced roadmap.

**Mode-Aware**: Reads `.mode` file to determine input/output paths.

---

## Mode Detection

| Context | Greenfield | Enhancer |
|---------|------------|----------|
| Input | `VISION.md` | `.enhancer/VISION.md` + `.enhancer/DISCOVERY.md` |
| Output | `ARCHITECTURE.md`, `ROADMAP.md` | `.enhancer/ARCHITECTURE.md`, `.enhancer/ROADMAP.md` |
| Focus | Design from scratch | Design within existing patterns |
| Constraint | Claude Code + Python | Must integrate with existing codebase |

---

## Pre-Flight Check

Verify prerequisite:

```
1. Read `.mode` file
2. Check VISION.md exists (path based on mode)
3. If missing → "Phase 1 not complete. Run /phases/1 first."
4. If exists → Proceed
```

---

## What This Phase Does

**The tech-architect agent will:**

1. **RESEARCH** - Multi-round technology discovery
   - Round 1: Requirements analysis
   - Round 2: Technology options deep dive
   - Round 3: Architecture validation

2. **ARCHITECT** - Design the system
   - Map features to components
   - Define data model
   - Design API surface
   - Plan payments infrastructure

3. **ROADMAP** - Sequence the build
   - Analyze dependencies
   - Group into phases
   - Define acceptance criteria

**Outputs:**
- `ARCHITECTURE.md` (or `.enhancer/ARCHITECTURE.md`)
- `ROADMAP.md` (or `.enhancer/ROADMAP.md`)

---

## Instructions for Claude

**Invoke the tech-architect agent** with these directives:

### Your Mission

You translate vision into buildable architecture. Research technologies, design systems, sequence the build. You are the final authority on HOW features get built.

### Mode-Specific Context

**If Greenfield:**
- Full creative freedom on tech stack
- Design from first principles
- Output: `ARCHITECTURE.md`, `ROADMAP.md` at project root

**If Enhancer:**
- Read `.enhancer/DISCOVERY.md` first
- Must integrate with existing tech stack
- Follow existing patterns from discovery
- Output: `.enhancer/ARCHITECTURE.md`, `.enhancer/ROADMAP.md`

### Process

**1. RESEARCH Mode** (3 rounds):
- Round 1: Analyze VISION.md features, extract requirements
- Round 2: Research technology options (use WebSearch)
- Round 3: Present recommendations, get approval
- **Always research payments** - Stripe patterns for the monetization model

**2. ARCHITECT Mode**:
- Map features (F1, F2...) to components
- Identify shared primitives
- Design for extension by addition
- Include payments architecture (REQUIRED)

**3. ROADMAP Mode**:
- Analyze feature dependencies
- Sequence into buildable phases
- **Phase 1 ALWAYS includes payments** - F-PAY is mandatory
- Define acceptance criteria per phase

### Output Locations

Based on mode:
- **Greenfield**: `ARCHITECTURE.md`, `ROADMAP.md` at project root
- **Enhancer**: `.enhancer/ARCHITECTURE.md`, `.enhancer/ROADMAP.md`

### ARCHITECTURE.md Structure

```markdown
# [App Name] - Architecture

## System Overview
## Tech Stack
| Layer | Technology | Justification |

## System Diagram
## Data Model
### Entities
### Schema

## Payments Architecture (REQUIRED)
- Stripe Products (Checkout/Billing/Portal)
- Webhook Events
- User Tiers & Feature Flags
- Feature Gating approach
- Paywall Flows

## API Design
## Feature-to-Component Map
| Feature ID | Components | Shared Primitives | Tier |

## Shared Primitives
## Extension Points
## Deployment Architecture
```

### ROADMAP.md Structure

```markdown
# [App Name] - Build Roadmap

## Dependency Graph

## Build Phases

### Phase 1: Foundation + Payments
**Features:** F1 (Auth), F-PAY (Billing)
**CRITICAL:** Payments is ALWAYS Phase 1

| Feature | Dependencies | Acceptance Criteria | Tier |

### Phase 2: [Name]
### Phase N: Complete

## Critical Path
## Risk Areas
```

### Key Principles

- **MRR is King** - Payments in Phase 1, not "later"
- **Extension by addition** - New features don't modify existing ones
- **Ruthless minimalism** - Simple primitives, emergent complexity
- **See the whole build** - Design Phase 1 with Phase N in mind

### Completion Criteria

Phase 2 is complete when:
- [ ] ARCHITECTURE.md exists (correct location)
- [ ] ROADMAP.md exists (correct location)
- [ ] All VISION.md features mapped
- [ ] Payments architecture defined
- [ ] Build phases sequenced
- [ ] Human has approved

---

## Handoff

```
✅ Phase 2 Complete: Technical Foundation

ARCHITECTURE.md: {path based on mode}
ROADMAP.md: {path based on mode}

Technical foundation is set:
- Tech stack chosen
- Architecture designed
- Features mapped to components
- Build sequence defined
- Payments infrastructure planned

Ready for Phase 3: Build

Run: /phases/3
```

---

## Remember

- **MRR is King** - Payments infrastructure in Phase 1
- **You define HOW** - Vision says WHAT, you say HOW and WHEN
- **Research is mandatory** - Don't guess technologies
- **Extension by addition** - Never design for modification
- **Pragmatic over perfect** - Working software beats elegant theory
